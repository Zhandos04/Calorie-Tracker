# Calorie Tracker API

REST API сервис для отслеживания дневной нормы калорий пользователя и учета съеденных блюд.

## Обзор

Данное приложение предоставляет возможность:
- Управлять информацией о пользователях, включая автоматический расчет дневной нормы калорий на основе их физических параметров и целей.
- Добавлять блюда с информацией о питательной ценности.
- Вести учет приемов пищи с возможностью выбора из списка блюд.
- Получать отчеты о питании, включая дневные суммы калорий и проверку соответствия дневной норме.

## Технологический стек

- Java 17
- Spring Boot 3.2.4
- Spring Data JPA
- PostgreSQL
- Flyway для миграций базы данных
- Gradle
- JUnit 5 и Mockito для тестирования

## Основные функции

### Пользователи
- Создание и управление пользователями с параметрами: имя, email, возраст, вес, рост и цель (похудение, поддержание, набор массы).
- Автоматический расчет дневной нормы калорий по формуле Харриса-Бенедикта.

### Блюда
- Добавление блюд с информацией о калорийности, белках, жирах и углеводах на порцию.
- Поиск блюд по названию.

### Приемы пищи
- Создание приемов пищи с указанием даты, времени и типа (завтрак, обед, ужин и т.д.).
- Добавление в прием пищи любого количества блюд с указанием порций.

### Отчеты
- Суточный отчет с информацией о всех приемах пищи и суммой калорий.
- Проверка соответствия дневной нормы калорий.
- История питания по дням за указанный период.

## Структура проекта

```
calorie-tracker/
├── src/
│   ├── main/
│   │   ├── java/com/example/calorietracker/
│   │   │   ├── controller/        # REST контроллеры
│   │   │   ├── service/           # Бизнес-логика
│   │   │   ├── repository/        # Репозитории для доступа к БД
│   │   │   ├── model/             # Entity-классы
│   │   │   ├── dto/               # DTO-объекты
│   │   │   ├── exception/         # Обработка исключений
│   │   │   └── CalorieTrackerApplication.java
│   │   └── resources/
│   │       ├── application.properties
│   └── test/
│       └── java/com/example/calorietracker/
│           ├── controller/        # Тесты контроллеров
│           ├── service/           # Тесты сервисов
│           └── repository/        # Тесты репозиториев
└── build.gradle                   # Файл конфигурации Gradle
```

## База данных

### Схема базы данных

![Database Schema](https://lucid.app/publicSegments/view/36c9f7d0-bf71-442e-af22-63756fa308ee/image.png)

### Таблицы:
- `users` - информация о пользователях
- `foods` - доступные блюда и их питательная ценность
- `meals` - приемы пищи пользователей
- `meal_foods` - связь между приемами пищи и блюдами (с указанием порций)

## API Endpoints

### Пользователи

- `POST /api/users` - Создание нового пользователя
- `GET /api/users` - Получение списка всех пользователей
- `GET /api/users/{id}` - Получение информации о пользователе по ID
- `PUT /api/users/{id}` - Обновление данных пользователя
- `DELETE /api/users/{id}` - Удаление пользователя

### Блюда

- `POST /api/foods` - Добавление нового блюда
- `GET /api/foods` - Получение списка всех блюд
- `GET /api/foods/{id}` - Получение информации о блюде по ID
- `GET /api/foods/search?name={query}` - Поиск блюд по названию
- `PUT /api/foods/{id}` - Обновление информации о блюде
- `DELETE /api/foods/{id}` - Удаление блюда

### Приемы пищи

- `POST /api/meals` - Создание нового приема пищи
- `GET /api/meals/{id}` - Получение информации о приеме пищи по ID
- `GET /api/meals/user/{userId}/date/{date}` - Получение приемов пищи пользователя за день
- `GET /api/meals/user/{userId}/period?startDate={date}&endDate={date}` - Получение приемов пищи за период
- `PUT /api/meals/{id}` - Обновление приема пищи
- `DELETE /api/meals/{id}` - Удаление приема пищи

### Отчеты

- `GET /api/reports/daily/{userId}/{date}` - Получение отчета о питании за день
- `GET /api/reports/calorie-check/{userId}/{date}` - Проверка соответствия дневной нормы калорий
- `GET /api/reports/history/{userId}?startDate={date}&endDate={date}` - История питания по дням
- `GET /api/reports/meal-dates/{userId}` - Даты, в которые пользователь принимал пищу

## Установка и запуск

### Предварительные требования

- JDK 17
- PostgreSQL 13+
- Gradle 7.6+

### Настройка базы данных

1. Создайте базу данных в PostgreSQL:
   ```sql
   CREATE DATABASE calorie_tracker;
   ```

2. Настройте параметры подключения к БД в файле `application.properties`:
   ```properties
   spring.datasource.url=jdbc:postgresql://localhost:5432/calorie_tracker
   spring.datasource.username=postgres
   spring.datasource.password=postgres
   ```

### Сборка и запуск приложения

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/yourusername/calorie-tracker.git
   cd calorie-tracker
   ```

2. Соберите приложение:
   ```bash
   ./gradlew build
   ```

3. Запустите приложение:
   ```bash
   ./gradlew bootRun
   ```
   или
   ```bash
   java -jar build/libs/calorie-tracker-0.0.1-SNAPSHOT.jar
   ```

Приложение будет доступно по адресу: http://localhost:8080

## Тестирование

Для запуска тестов выполните команду:
```bash
./gradlew test
```

## Расчет нормы калорий

В приложении используется модифицированная формула Харриса-Бенедикта для расчета базового метаболического уровня (BMR):

```
BMR = 10 * вес(кг) + 6.25 * рост(см) - 5 * возраст(лет) + 5
```

Дневная норма калорий рассчитывается с учетом цели пользователя:
- Похудение: BMR * 0.8 (дефицит 20%)
- Поддержание: BMR (без изменений)
- Набор массы: BMR * 1.15 (профицит 15%)

## Валидация данных

В приложении реализована валидация входных данных:
- Проверка физических параметров на адекватность (вес, рост, возраст)
- Проверка уникальности email
- Проверка корректности дат и других параметров

## Обработка ошибок

Реализована глобальная обработка исключений с возвратом соответствующих HTTP-статусов:
- 400 Bad Request - некорректные данные
- 404 Not Found - ресурс не найден
- 500 Internal Server Error - внутренняя ошибка сервера